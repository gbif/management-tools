
<div class="card-area">
    <h2 class="md-headline">Crawl history</h2>
    <md-card>
        <div layout-gt-xs="row" layout-padding>
            <md-input-container class="md-block" flex-gt-xs>
                <label>Enter a dataset UUID</label>
                <input ng-model="$ctrl.uuid">
            </md-input-container>

            <md-input-container>
                <md-button class="md-primary" ng-click="$ctrl.getCrawlData()">Get history</md-button>
            </md-input-container>
        </div>

        <md-divider></md-divider>

        <md-content class="md-padding white" ng-if="$ctrl.uuid">
            <div>
                <div>Dataset: {{ $ctrl.dataset.title}}</div>
            </div>
            <table class="table table-responsive-vertical">
                <thead>
                    <tr>
                        <th>Started</th>
                        <th>Finished</th>
                        <th>Recieved</th>
                        <th>New</th>
                        <th>Updated</th>
                        <th>Unchanged</th>
                        <th>Failed</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="row in $ctrl.rowCollection.results">
                        <td>{{row.startedCrawling | amDateFormat:'YYYY-MM-D HH:mm'}}</td>
                        <td>{{row.finishedCrawling | amDateFormat:'YYYY-MM-D HH:mm'}}</td>
                        <td>
                            <span ng-if="row.fragmentsReceived - row.rawOccurrencesPersistedNew -row.rawOccurrencesPersistedUpdated - row.rawOccurrencesPersistedUnchanged == 0">{{row.fragmentsReceived}}</span>
                            <span class="badge-red" ng-if="row.fragmentsReceived - row.rawOccurrencesPersistedNew -row.rawOccurrencesPersistedUpdated - row.rawOccurrencesPersistedUnchanged != 0">
                                {{row.fragmentsReceived}}
                                <md-tooltip md-direction="top">Received fragments expected to equal New+Updated+Unchanged</md-tooltip>
                            </span>
                        </td>
                        <td>{{row.rawOccurrencesPersistedNew}}</td>
                        <td>{{row.rawOccurrencesPersistedUpdated}}</td>
                        <td>{{row.rawOccurrencesPersistedUnchanged}}</td>
                        <td>
                            <span ng-class="{'badge-red': row.rawOccurrencesPersistedError > 0}">{{row.rawOccurrencesPersistedError}}</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </md-content>

    </md-card>
</div>